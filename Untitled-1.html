import { useState, useRef, useEffect } from "react";

const css = `
  @import url('https://fonts.googleapis.com/css2?family=Tiro+Kannada:ital@0;1&family=Syne:wght@400;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --soil:       #1C1008;
    --bark:       #3B1F0C;
    --terra:      #C4541A;
    --terra-lite: #E07040;
    --harvest:    #D9920A;
    --gold:       #F2C84B;
    --paddy:      #3A6B30;
    --leaf:       #5A9E4A;
    --leaf-lite:  #7CC46A;
    --sky:        #5BA3C9;
    --sky-lite:   #90C4DC;
    --cream:      #F2E4C4;
    --parch:      #E8D5A8;
    --muted:      rgba(242,228,196,0.45);
    --card:       rgba(59,31,12,0.55);
    --border:     rgba(242,228,196,0.12);
  }

  body { background: var(--soil); font-family: 'DM Sans', sans-serif; color: var(--cream); }

  .km-root {
    max-width: 430px;
    margin: 0 auto;
    min-height: 100svh;
    background: var(--soil);
    overflow-x: hidden;
    position: relative;
  }

  /* ‚îÄ‚îÄ NOISE GRAIN ‚îÄ‚îÄ */
  .km-root::after {
    content:'';
    position:fixed; inset:0;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
    pointer-events:none; z-index:9999; mix-blend-mode:overlay;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .km-header {
    background: linear-gradient(160deg, #2E1508 0%, var(--bark) 100%);
    padding: 18px 20px 28px;
    position: relative;
    overflow: hidden;
  }
  .km-header::before {
    content: '';
    position: absolute;
    top: -60px; right: -60px;
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(196,84,26,0.25) 0%, transparent 70%);
    border-radius: 50%;
  }
  .km-header::after {
    content: '';
    position: absolute;
    bottom: -1px; left: 0; right: 0;
    height: 28px;
    background: var(--soil);
    clip-path: ellipse(52% 100% at 50% 100%);
  }
  .km-hdr-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .km-brand {
    display: flex; align-items: center; gap: 11px;
  }
  .km-logo {
    width: 46px; height: 46px;
    background: linear-gradient(145deg, var(--terra) 0%, var(--harvest) 100%);
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    box-shadow: 0 6px 18px rgba(196,84,26,0.45), inset 0 1px 0 rgba(255,255,255,0.2);
  }
  .km-brand-text h1 {
    font-family: 'Syne', sans-serif;
    font-weight: 800; font-size: 19px;
    color: var(--cream); letter-spacing: 0.3px;
  }
  .km-brand-text .kan {
    font-family: 'Tiro Kannada', serif;
    font-size: 12px; color: var(--gold);
    display: block; margin-top: 1px;
  }
  .km-weather {
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.13);
    border-radius: 22px;
    padding: 7px 13px;
    font-size: 12px; color: var(--sky-lite);
    display: flex; align-items: center; gap: 5px;
  }

  /* ‚îÄ‚îÄ HERO BAND ‚îÄ‚îÄ */
  .km-hero {
    margin: 0 16px 0;
    background: linear-gradient(135deg, var(--paddy) 0%, #2E5527 100%);
    border-radius: 20px 20px 0 0;
    padding: 18px 18px 22px;
    position: relative; overflow: hidden;
  }
  .km-hero::before {
    content: 'üåæ';
    position: absolute; right: 8px; bottom: -6px;
    font-size: 90px; opacity: 0.1; transform: rotate(15deg);
    user-select: none;
  }
  .km-hero h2 {
    font-family: 'Tiro Kannada', serif;
    font-size: 20px; color: #fff; line-height: 1.35;
    margin-bottom: 4px;
  }
  .km-hero p { font-size: 12px; color: rgba(255,255,255,0.65); margin-bottom: 14px; }
  .km-hero-pills { display: flex; gap: 8px; }
  .km-pill {
    background: rgba(255,255,255,0.13);
    backdrop-filter: blur(8px);
    border-radius: 10px; padding: 8px 12px;
    flex: 1; text-align: center;
  }
  .km-pill .pv {
    font-family:'Syne',sans-serif; font-weight:700;
    font-size:15px; color:#fff; display:block;
  }
  .km-pill .pl { font-size:10px; color:rgba(255,255,255,0.6); display:block; margin-top:2px; }

  /* ‚îÄ‚îÄ NAV TABS ‚îÄ‚îÄ */
  .km-nav {
    display: flex; gap: 0;
    padding: 14px 16px 0;
    overflow-x: auto; scrollbar-width: none;
  }
  .km-nav::-webkit-scrollbar { display: none; }
  .km-tab {
    flex-shrink: 0;
    padding: 9px 13px; border-radius: 22px;
    border: 1.5px solid transparent;
    background: transparent;
    color: var(--muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 12.5px; font-weight: 500;
    cursor: pointer; transition: all 0.22s;
    display: flex; align-items: center; gap: 5px;
    white-space: nowrap;
  }
  .km-tab:hover { color: var(--cream); background: rgba(255,255,255,0.05); }
  .km-tab.active {
    background: var(--terra);
    border-color: var(--terra-lite);
    color: #fff;
    box-shadow: 0 3px 12px rgba(196,84,26,0.4);
  }

  /* ‚îÄ‚îÄ CONTENT AREA ‚îÄ‚îÄ */
  .km-content { padding: 16px 16px 100px; }

  /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
  .km-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 18px;
    margin-bottom: 14px;
    backdrop-filter: blur(10px);
  }
  .km-card-title {
    font-family: 'Syne', sans-serif;
    font-weight: 700; font-size: 15px;
    color: var(--cream); margin-bottom: 4px;
    display: flex; align-items: center; gap: 7px;
  }
  .km-card-sub { font-size: 12px; color: var(--muted); margin-bottom: 14px; }

  /* ‚îÄ‚îÄ SECTION HEADING ‚îÄ‚îÄ */
  .km-section-head {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 14px;
  }
  .km-section-head .icon {
    width: 34px; height: 34px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 17px; flex-shrink: 0;
  }
  .km-section-head .texts h3 {
    font-family: 'Syne', sans-serif;
    font-weight: 700; font-size: 16px; color: var(--cream);
  }
  .km-section-head .texts p { font-size: 12px; color: var(--muted); }

  /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
  .km-label { font-size: 12px; color: var(--muted); margin-bottom: 6px; display: block; }
  .km-select, .km-input {
    width: 100%; background: rgba(255,255,255,0.06);
    border: 1.5px solid var(--border);
    border-radius: 12px; padding: 11px 14px;
    color: var(--cream); font-family: 'DM Sans', sans-serif;
    font-size: 14px; outline: none; appearance: none;
    transition: border-color 0.2s;
  }
  .km-select:focus, .km-input:focus { border-color: var(--terra); }
  .km-select option { background: var(--bark); color: var(--cream); }
  .km-row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  /* ‚îÄ‚îÄ BUTTON ‚îÄ‚îÄ */
  .km-btn {
    width: 100%; padding: 13px;
    background: linear-gradient(135deg, var(--terra) 0%, #9C3A0E 100%);
    border: none; border-radius: 13px;
    color: #fff; font-family: 'Syne', sans-serif;
    font-weight: 700; font-size: 14px; cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    box-shadow: 0 4px 16px rgba(196,84,26,0.4);
    transition: transform 0.15s, box-shadow 0.15s;
    margin-top: 14px;
  }
  .km-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(196,84,26,0.5); }
  .km-btn:active { transform: scale(0.98); }
  .km-btn.green {
    background: linear-gradient(135deg, var(--paddy) 0%, #234A1C 100%);
    box-shadow: 0 4px 16px rgba(58,107,48,0.4);
  }
  .km-btn.green:hover { box-shadow: 0 6px 20px rgba(58,107,48,0.5); }

  /* ‚îÄ‚îÄ UPLOAD ZONE ‚îÄ‚îÄ */
  .km-upload {
    border: 2px dashed rgba(242,200,75,0.35);
    border-radius: 14px; padding: 28px 16px;
    text-align: center; cursor: pointer;
    transition: all 0.2s; background: rgba(242,200,75,0.04);
    position: relative; overflow: hidden;
  }
  .km-upload:hover { border-color: var(--gold); background: rgba(242,200,75,0.08); }
  .km-upload input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
  .km-upload .icon { font-size: 36px; display: block; margin-bottom: 8px; }
  .km-upload .hint { font-size: 13px; color: var(--gold); font-weight: 500; }
  .km-upload .sub { font-size: 11px; color: var(--muted); margin-top: 4px; }
  .km-upload.has-img { border-style: solid; border-color: var(--leaf); background: rgba(90,158,74,0.1); }
  .km-upload .preview-img { width:100%; max-height:160px; object-fit:cover; border-radius:10px; display:block; }

  /* ‚îÄ‚îÄ RESULT CARD ‚îÄ‚îÄ */
  .km-result {
    background: linear-gradient(135deg, rgba(58,107,48,0.3) 0%, rgba(58,107,48,0.1) 100%);
    border: 1.5px solid rgba(90,158,74,0.4);
    border-radius: 14px; padding: 16px;
    margin-top: 14px; animation: slideUp 0.4s ease;
  }
  .km-result.danger {
    background: linear-gradient(135deg, rgba(196,84,26,0.3) 0%, rgba(196,84,26,0.1) 100%);
    border-color: rgba(196,84,26,0.4);
  }
  .km-result-head {
    display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
  }
  .km-result-head .badge {
    width: 36px; height: 36px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center; font-size: 18px;
  }
  .km-result-head .badge.ok { background: rgba(90,158,74,0.3); }
  .km-result-head .badge.warn { background: rgba(196,84,26,0.3); }
  .km-result-head h4 { font-family:'Syne',sans-serif; font-weight:700; font-size:15px; color:var(--cream); }
  .km-result-head .conf { font-size:11px; color:var(--gold); }
  .km-detail-row {
    display: flex; align-items: flex-start; gap: 8px;
    padding: 8px 0; border-top: 1px solid rgba(255,255,255,0.07);
    font-size: 13px;
  }
  .km-detail-row .dt { color: var(--muted); flex-shrink: 0; width: 90px; }
  .km-detail-row .dd { color: var(--cream); font-weight: 500; }
  .km-kan-text { font-family:'Tiro Kannada',serif; font-size:13px; color:var(--parch); margin-top:8px; line-height:1.6; }

  /* ‚îÄ‚îÄ IRRIGATION SCHEDULE ‚îÄ‚îÄ */
  .km-schedule { margin-top: 14px; }
  .km-day-row {
    display: flex; align-items: center; gap: 12px;
    padding: 11px 14px; border-radius: 12px;
    margin-bottom: 8px;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    animation: slideUp 0.3s ease both;
  }
  .km-day-row:nth-child(2){animation-delay:0.05s}
  .km-day-row:nth-child(3){animation-delay:0.1s}
  .km-day-row:nth-child(4){animation-delay:0.15s}
  .km-day-row:nth-child(5){animation-delay:0.2s}
  .km-day-row .day-icon {
    width: 36px; height: 36px; border-radius: 10px;
    background: linear-gradient(135deg, var(--sky) 0%, #3A7A9C 100%);
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
  }
  .km-day-row.dry .day-icon { background: linear-gradient(135deg, var(--harvest) 0%, #A36A05 100%); }
  .km-day-row.skip .day-icon { background: rgba(255,255,255,0.08); }
  .km-day-row .day-info { flex: 1; }
  .km-day-row .day-name { font-size:13px; font-weight:600; color:var(--cream); }
  .km-day-row .day-detail { font-size:11px; color:var(--muted); }
  .km-day-row .day-amount {
    font-family:'Syne',sans-serif; font-weight:700;
    font-size:14px; color:var(--sky-lite);
  }
  .km-day-row.dry .day-amount { color: var(--gold); }
  .km-day-row.skip .day-amount { color: var(--muted); font-size:12px; }

  /* ‚îÄ‚îÄ MANDI PRICES ‚îÄ‚îÄ */
  .km-mandi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .km-mandi-item {
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    border-radius: 14px; padding: 13px;
    transition: transform 0.18s;
    animation: slideUp 0.4s ease both;
  }
  .km-mandi-item:nth-child(2){animation-delay:0.07s}
  .km-mandi-item:nth-child(3){animation-delay:0.14s}
  .km-mandi-item:nth-child(4){animation-delay:0.21s}
  .km-mandi-item:nth-child(5){animation-delay:0.28s}
  .km-mandi-item:nth-child(6){animation-delay:0.35s}
  .km-mandi-item:hover { transform: translateY(-2px); }
  .km-mandi-item .crop-icon { font-size: 26px; display:block; margin-bottom: 7px; }
  .km-mandi-item .crop-name { font-size:12px; color:var(--muted); }
  .km-mandi-item .crop-kan { font-family:'Tiro Kannada',serif; font-size:12px; color:var(--gold); }
  .km-mandi-item .crop-price {
    font-family:'Syne',sans-serif; font-weight:800;
    font-size:20px; color:var(--cream);
    margin: 4px 0 2px;
  }
  .km-mandi-item .crop-unit { font-size:10px; color:var(--muted); }
  .km-mandi-item .trend {
    display: inline-flex; align-items: center; gap: 3px;
    font-size:11px; font-weight:600;
    padding: 2px 7px; border-radius:8px; margin-top:6px;
  }
  .km-mandi-item .trend.up { background:rgba(90,158,74,0.2); color:var(--leaf-lite); }
  .km-mandi-item .trend.down { background:rgba(196,84,26,0.2); color:var(--terra-lite); }
  .km-mandi-item .trend.flat { background:rgba(255,255,255,0.07); color:var(--muted); }

  .km-mandi-filter {
    display: flex; gap: 8px; margin-bottom: 14px;
    overflow-x: auto; scrollbar-width: none;
  }
  .km-mandi-filter::-webkit-scrollbar { display: none; }
  .km-filter-pill {
    flex-shrink: 0; padding: 6px 14px;
    border-radius: 18px; border: 1.5px solid var(--border);
    background: transparent; color: var(--muted);
    font-family:'DM Sans',sans-serif; font-size:12px;
    cursor: pointer; transition: all 0.2s;
  }
  .km-filter-pill.active {
    border-color: var(--harvest); background: rgba(217,146,10,0.15);
    color: var(--gold);
  }

  .km-best-sell {
    background: linear-gradient(135deg, rgba(217,146,10,0.2) 0%, rgba(217,146,10,0.07) 100%);
    border: 1.5px solid rgba(217,146,10,0.35);
    border-radius: 14px; padding: 14px;
    margin-top: 14px; display: flex; gap: 12px; align-items: center;
  }
  .km-best-sell .bs-icon { font-size: 28px; flex-shrink: 0; }
  .km-best-sell h4 { font-family:'Syne',sans-serif; font-weight:700; font-size:14px; color:var(--gold); }
  .km-best-sell p { font-size:12px; color:var(--muted); margin-top:3px; }

  /* ‚îÄ‚îÄ SPARKLINE ‚îÄ‚îÄ */
  .km-sparkline { margin-top: 8px; }
  .km-sparkline svg { display: block; }

  /* ‚îÄ‚îÄ VOICE ASSISTANT ‚îÄ‚îÄ */
  .km-voice-center { text-align: center; padding: 10px 0 20px; }
  .km-mic-wrapper {
    position: relative; display: inline-flex;
    align-items: center; justify-content: center;
    margin-bottom: 20px;
  }
  .km-mic-btn {
    width: 90px; height: 90px; border-radius: 50%;
    background: linear-gradient(145deg, var(--terra) 0%, #8C2E08 100%);
    border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 38px;
    box-shadow: 0 0 0 0 rgba(196,84,26,0.5);
    transition: transform 0.15s;
    position: relative; z-index: 2;
  }
  .km-mic-btn:hover { transform: scale(1.05); }
  .km-mic-btn.listening {
    animation: micPulse 1.5s ease-in-out infinite;
    background: linear-gradient(145deg, #E04020 0%, var(--terra) 100%);
  }
  .km-mic-ring {
    position: absolute;
    width: 110px; height: 110px;
    border-radius: 50%;
    border: 2px solid var(--terra);
    opacity: 0; animation: ringOut 1.5s ease-in-out infinite;
    top: 50%; left: 50%; transform: translate(-50%,-50%);
  }
  .km-mic-ring:nth-child(2) { animation-delay: 0.5s; }
  .km-mic-ring:nth-child(3) { animation-delay: 1s; }
  .km-voice-prompt {
    font-family: 'Tiro Kannada', serif;
    font-size: 16px; color: var(--cream); margin-bottom: 8px;
  }
  .km-voice-hint { font-size: 12px; color: var(--muted); margin-bottom: 24px; }

  .km-chat-log {
    display: flex; flex-direction: column; gap: 10px;
    max-height: 320px; overflow-y: auto;
    scrollbar-width: thin; scrollbar-color: var(--border) transparent;
  }
  .km-bubble {
    max-width: 82%; padding: 11px 14px;
    border-radius: 16px; font-size: 13px;
    line-height: 1.5; animation: slideUp 0.3s ease;
  }
  .km-bubble.user {
    align-self: flex-end;
    background: var(--terra);
    border-bottom-right-radius: 4px;
    color: #fff;
  }
  .km-bubble.bot {
    align-self: flex-start;
    background: rgba(255,255,255,0.07);
    border: 1px solid var(--border);
    border-bottom-left-radius: 4px;
  }
  .km-bubble .bkan { font-family:'Tiro Kannada',serif; font-size:14px; display:block; }
  .km-bubble .beng { font-size:11px; color:var(--muted); display:block; margin-top:3px; }
  .km-bubble.bot .bkan { color: var(--cream); }

  .km-quick-btns {
    display: flex; flex-wrap: wrap; gap: 8px;
    margin-top: 14px;
  }
  .km-quick {
    padding: 7px 13px; border-radius: 16px;
    border: 1.5px solid var(--border);
    background: rgba(255,255,255,0.04);
    color: var(--parch);
    font-family: 'Tiro Kannada', serif; font-size: 13px;
    cursor: pointer; transition: all 0.2s;
  }
  .km-quick:hover { border-color: var(--terra); background: rgba(196,84,26,0.12); color: #fff; }

  /* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
  .km-bottom-nav {
    position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 100%; max-width: 430px;
    background: rgba(28,16,8,0.9);
    backdrop-filter: blur(16px);
    border-top: 1px solid var(--border);
    display: flex; padding: 10px 8px 18px;
    z-index: 100;
  }
  .km-bnav-item {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; gap: 4px;
    padding: 6px 4px; border-radius: 12px;
    cursor: pointer; transition: all 0.2s;
    border: none; background: transparent; color: var(--muted);
  }
  .km-bnav-item.active { color: var(--terra); }
  .km-bnav-item .bni { font-size: 22px; }
  .km-bnav-item .bnl { font-size: 10px; font-family:'Tiro Kannada',serif; }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes slideUp {
    from { opacity:0; transform: translateY(16px); }
    to   { opacity:1; transform: translateY(0); }
  }
  @keyframes micPulse {
    0%,100% { box-shadow: 0 0 0 0 rgba(196,84,26,0.6); }
    50%      { box-shadow: 0 0 0 18px rgba(196,84,26,0); }
  }
  @keyframes ringOut {
    0%   { opacity:0.6; width:110px; height:110px; }
    100% { opacity:0; width:160px; height:160px; }
  }
  @keyframes spin {
    from { transform: rotate(0deg); } to { transform: rotate(360deg); }
  }
  .km-spin { animation: spin 0.8s linear infinite; display:inline-block; }
`;

// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const DISEASES = {
  paddy: {
    disease: "Blast Disease (‡≤¨‡≥ç‡≤≤‡≤æ‡≤∏‡≥ç‡≤ü‡≥ç ‡≤∞‡≥ã‡≤ó)",
    confidence: "89%",
    severity: "High",
    cause: "Fungus: Magnaporthe oryzae",
    treatment: "Spray Tricyclazole 75WP @ 6g/10L water",
    pesticide: "Beam / Baan (Tricyclazole)",
    organic: "Neem leaf extract 5% spray",
    kannada: "‡≤ü‡≥ç‡≤∞‡≥à‡≤∏‡≥à‡≤ï‡≥ç‡≤≤‡≤æ‡≤ù‡≥ã‡≤≤‡≥ç 75WP @ 10 ‡≤≤‡≥Ä‡≤ü‡≤∞‡≥ç ‡≤®‡≥Ä‡≤∞‡≤ø‡≤ó‡≥Ü 6‡≤ó‡≥ç‡≤∞‡≤æ‡≤Ç ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø. 7 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≥Å‡≤ß‡≤æ‡≤∞‡≤£‡≥Ü ‡≤ï‡≤æ‡≤£‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.",
  },
  maize: {
    disease: "Fall Armyworm (‡≤≤‡≤∑‡≥ç‡≤ï‡≤∞‡≤ø ‡≤π‡≥Å‡≤≥)",
    confidence: "92%",
    severity: "Very High",
    cause: "Pest: Spodoptera frugiperda",
    treatment: "Spray Emamectin Benzoate 5SG @ 4g/15L",
    pesticide: "Coragen / Delegate",
    organic: "Release egg parasitoid Trichogramma",
    kannada: "‡≤é‡≤Æ‡≤æ‡≤Æ‡≥Ü‡≤ï‡≥ç‡≤ü‡≤ø‡≤®‡≥ç 5SG @ 15 ‡≤≤‡≥Ä‡≤ü‡≤∞‡≥ç ‡≤®‡≥Ä‡≤∞‡≤ø‡≤ó‡≥Ü 4‡≤ó‡≥ç‡≤∞‡≤æ‡≤Ç ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø. ‡≤¨‡≥Ü‡≤≥‡≤ø‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≤Ç‡≤ú‡≥Ü ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø.",
  },
  arecanut: {
    disease: "Yellow Leaf Disease (‡≤π‡≤≥‡≤¶‡≤ø ‡≤é‡≤≤‡≥Ü ‡≤∞‡≥ã‡≤ó)",
    confidence: "85%",
    severity: "Medium",
    cause: "Phytoplasma infection (vector: leafhoppers)",
    treatment: "Remove infected palms, spray Imidacloprid",
    pesticide: "Confidor / Tatamida",
    organic: "Apply neem cake 2kg per palm",
    kannada: "‡≤∏‡≥ã‡≤Ç‡≤ï‡≤ø‡≤§ ‡≤Æ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å ‡≤π‡≤æ‡≤ï‡≤ø. ‡≤á‡≤Æ‡≤ø‡≤°‡≤æ‡≤ï‡≥ç‡≤≤‡≥ã‡≤™‡≥ç‡≤∞‡≤ø‡≤°‡≥ç 0.3‡≤Æ‡≤ø.‡≤≤‡≥Ä/‡≤≤‡≥Ä‡≤ü‡≤∞‡≥ç ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø.",
  },
};

const IRRIGATION_SCHEDULES = {
  paddy_clay: [
    { day:"Mon", type:"water", amount:"5L/m¬≤", detail:"Morning 6‚Äì8 AM", icon:"üíß" },
    { day:"Tue", type:"skip", amount:"Rest", detail:"Monitor soil moisture", icon:"‚òÅÔ∏è" },
    { day:"Wed", type:"water", amount:"5L/m¬≤", detail:"Morning 6‚Äì8 AM", icon:"üíß" },
    { day:"Thu", type:"skip", amount:"Rest", detail:"Monitor soil moisture", icon:"‚òÅÔ∏è" },
    { day:"Fri", type:"water", amount:"5L/m¬≤", detail:"Morning 6‚Äì8 AM", icon:"üíß" },
  ],
  paddy_loam: [
    { day:"Mon", type:"water", amount:"6L/m¬≤", detail:"Morning 6‚Äì8 AM", icon:"üíß" },
    { day:"Tue", type:"water", amount:"4L/m¬≤", detail:"Evening 5‚Äì6 PM", icon:"üíß" },
    { day:"Wed", type:"dry", amount:"Fertilize", detail:"Apply Urea today", icon:"üå±" },
    { day:"Thu", type:"water", amount:"6L/m¬≤", detail:"Morning 6‚Äì8 AM", icon:"üíß" },
    { day:"Fri", type:"skip", amount:"Rest", detail:"Check leaf color", icon:"‚òÅÔ∏è" },
  ],
  maize_red: [
    { day:"Mon", type:"water", amount:"4L/m¬≤", detail:"Furrow irrigation", icon:"üíß" },
    { day:"Tue", type:"skip", amount:"Rest", detail:"Soil check", icon:"‚òÅÔ∏è" },
    { day:"Wed", type:"dry", amount:"Weeding", detail:"Remove weeds", icon:"üå±" },
    { day:"Thu", type:"water", amount:"4L/m¬≤", detail:"Furrow irrigation", icon:"üíß" },
    { day:"Fri", type:"skip", amount:"Rest", detail:"Monitor pests", icon:"‚òÅÔ∏è" },
  ],
  arecanut_laterite: [
    { day:"Mon", type:"water", amount:"8L/palm", detail:"Basin irrigation", icon:"üíß" },
    { day:"Tue", type:"skip", amount:"Rest", detail:"Observe new leaves", icon:"‚òÅÔ∏è" },
    { day:"Wed", type:"skip", amount:"Rest", detail:"Check for pests", icon:"‚òÅÔ∏è" },
    { day:"Thu", type:"water", amount:"8L/palm", detail:"Basin irrigation", icon:"üíß" },
    { day:"Fri", type:"dry", amount:"Mulching", detail:"Apply coconut husk mulch", icon:"üåø" },
  ],
};

const MANDI_PRICES = [
  { crop:"Paddy", kan:"‡≤≠‡≤§‡≥ç‡≤§", icon:"üåæ", price:"2,183", unit:"‚Çπ/quintal", change:"+‚Çπ45", dir:"up", mandi:"Davangere" },
  { crop:"Maize", kan:"‡≤ú‡≥ã‡≤≥", icon:"üåΩ", price:"1,856", unit:"‚Çπ/quintal", change:"+‚Çπ22", dir:"up", mandi:"Hubli" },
  { crop:"Arecanut", kan:"‡≤Ö‡≤°‡≤ø‡≤ï‡≥Ü", icon:"üå¥", price:"38,500", unit:"‚Çπ/quintal", change:"-‚Çπ300", dir:"down", mandi:"Shivamogga" },
  { crop:"Tomato", kan:"‡≤ü‡≥ä‡≤Æ‡≥ç‡≤Ø‡≤æ‡≤ü‡≥ä", icon:"üçÖ", price:"1,240", unit:"‚Çπ/quintal", change:"‚Üí Stable", dir:"flat", mandi:"Kolar" },
  { crop:"Ragi", kan:"‡≤∞‡≤æ‡≤ó‡≤ø", icon:"üåø", price:"3,578", unit:"‚Çπ/quintal", change:"+‚Çπ80", dir:"up", mandi:"Tumkur" },
  { crop:"Groundnut", kan:"‡≤∂‡≥á‡≤Ç‡≤ó‡≤æ", icon:"ü•ú", price:"5,120", unit:"‚Çπ/quintal", change:"-‚Çπ95", dir:"down", mandi:"Gadag" },
];

const CHAT_QA = [
  { q:"‡≤á‡≤Ç‡≤¶‡≥Å ‡≤≠‡≤§‡≥ç‡≤§‡≤¶ ‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤é‡≤∑‡≥ç‡≤ü‡≥Å?", a_kan:"‡≤á‡≤Ç‡≤¶‡≥Å ‡≤¶‡≤æ‡≤µ‡≤£‡≤ó‡≥Ü‡≤∞‡≥Ü ‡≤Æ‡≤Ç‡≤°‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤≠‡≤§‡≥ç‡≤§‡≤¶ ‡≤¨‡≥Ü‡≤≤‡≥Ü ‚Çπ2,183 ‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥ç‡≤µ‡≤ø‡≤Ç‡≤ü‡≤æ‡≤≤‡≥ç. ‡≤¨‡≥Ü‡≤≤‡≥Ü ‚Çπ45 ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.", a_eng:"Paddy price today: ‚Çπ2,183/quintal at Davangere. Up by ‚Çπ45." },
  { q:"‡≤®‡≤®‡≥ç‡≤® ‡≤≠‡≤§‡≥ç‡≤§ ‡≤é‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≤æ‡≤∞‡≤¨‡≥á‡≤ï‡≥Å?", a_kan:"‡≤à ‡≤µ‡≤æ‡≤∞ ‡≤¶‡≤æ‡≤µ‡≤£‡≤ó‡≥Ü‡≤∞‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≤≥‡≥ç‡≤≥‡≤æ‡≤∞‡≤ø ‡≤Æ‡≤Ç‡≤°‡≤ø‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø ‡≤¨‡≥Ü‡≤≤‡≥Ü ‡≤á‡≤¶‡≥Ü. ‡≤∂‡≤®‡≤ø‡≤µ‡≤æ‡≤∞ ‡≤Æ‡≤æ‡≤∞‡≤æ‡≤ü ‡≤Æ‡≤æ‡≤°‡≤ø.", a_eng:"Best to sell at Davangere or Ballari mandi this week. Saturday recommended." },
  { q:"‡≤Æ‡≤≥‡≥Ü ‡≤¨‡≤∞‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü‡≤Ø‡≥á?", a_kan:"‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤® 3 ‡≤¶‡≤ø‡≤® ‡≤¨‡≥Ü‡≤≥‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤Æ‡≥ã‡≤° ‡≤ï‡≤µ‡≤ø‡≤¶ ‡≤µ‡≤æ‡≤§‡≤æ‡≤µ‡≤∞‡≤£ ‡≤á‡≤∞‡≤≤‡≤ø‡≤¶‡≥Ü. ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø.", a_eng:"Overcast for next 3 days. Reduce irrigation by 30%." },
  { q:"‡≤ú‡≥ã‡≤≥‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Ø‡≤æ‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤π‡≤æ‡≤ï‡≤¨‡≥á‡≤ï‡≥Å?", a_kan:"‡≤Æ‡≥Ü‡≤ï‡≥ç‡≤ï‡≥Ü‡≤ú‡≥ã‡≤≥‡≤ï‡≥ç‡≤ï‡≥Ü DAP 50 ‡≤ï‡≥Ü‡≤ú‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ø‡≥Ç‡≤∞‡≤ø‡≤Ø‡≤æ 30 ‡≤ï‡≥Ü‡≤ú‡≤ø ‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤é‡≤ï‡≤∞‡≥Ü ‡≤π‡≤æ‡≤ï‡≤ø.", a_eng:"For maize: apply DAP 50kg + Urea 30kg per acre." },
];

// ‚îÄ‚îÄ‚îÄ SPARKLINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Sparkline({ data, color }) {
  const w = 80, h = 30;
  const min = Math.min(...data), max = Math.max(...data);
  const pts = data.map((v, i) => {
    const x = (i / (data.length - 1)) * w;
    const y = h - ((v - min) / (max - min + 0.001)) * h;
    return `${x},${y}`;
  }).join(" ");
  return (
    <svg width={w} height={h} viewBox={`0 0 ${w} ${h}`}>
      <polyline points={pts} fill="none" stroke={color} strokeWidth="2"
        strokeLinecap="round" strokeLinejoin="round" />
    </svg>
  );
}

// ‚îÄ‚îÄ‚îÄ TAB PAGES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function DiseaseTab() {
  const [img, setImg] = useState(null);
  const [crop, setCrop] = useState("paddy");
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState(null);
  const fileRef = useRef();

  const handleFile = (e) => {
    const f = e.target.files[0];
    if (!f) return;
    setImg(URL.createObjectURL(f));
    setResult(null);
  };

  const detect = () => {
    setLoading(true);
    setResult(null);
    setTimeout(() => {
      setLoading(false);
      setResult(DISEASES[crop]);
    }, 1800);
  };

  return (
    <div>
      <div className="km-section-head">
        <div className="km-section-head">
          <div className="icon" style={{background:"linear-gradient(135deg,#5A9E4A,#2E5527)"}}>üî¨</div>
          <div className="texts">
            <h3>AI Disease Detection</h3>
            <p style={{fontFamily:"'Tiro Kannada',serif",fontSize:12}}>‡≤ï‡≥ç‡≤Ø‡≤æ‡≤Æ‡≥Ü‡≤∞‡≤æ‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤´‡≥ã‡≤ü‡≥ã ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å ‡≤∞‡≥ã‡≤ó ‡≤ï‡≤Ç‡≤°‡≥Å‡≤π‡≤ø‡≤°‡≤ø‡≤Ø‡≤ø‡≤∞‡≤ø</p>
          </div>
        </div>
      </div>

      <div className="km-card">
        <label className="km-label">Select Crop / ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø</label>
        <select className="km-select" value={crop} onChange={e=>{ setCrop(e.target.value); setResult(null); }}>
          <option value="paddy">üåæ Paddy ‚Äì ‡≤≠‡≤§‡≥ç‡≤§</option>
          <option value="maize">üåΩ Maize ‚Äì ‡≤Æ‡≥Ü‡≤ï‡≥ç‡≤ï‡≥Ü‡≤ú‡≥ã‡≤≥</option>
          <option value="arecanut">üå¥ Arecanut ‚Äì ‡≤Ö‡≤°‡≤ø‡≤ï‡≥Ü</option>
        </select>

        <div style={{marginTop:14}}>
          <label className="km-label">Upload Leaf Photo / ‡≤é‡≤≤‡≥Ü ‡≤´‡≥ã‡≤ü‡≥ã ‡≤Ö‡≤™‡≥ç‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø</label>
          <div className={`km-upload ${img ? "has-img" : ""}`}>
            {/* Camera input ‚Äî opens rear camera on mobile */}
            <input
              ref={fileRef}
              type="file"
              accept="image/*"
              capture="environment"
              onChange={handleFile}
              style={{position:"absolute",inset:0,opacity:0,cursor:"pointer",zIndex:2}}
            />
            {img
              ? <>
                  <img src={img} className="preview-img" alt="leaf" />
                  <div style={{marginTop:10,fontSize:12,color:"var(--leaf-lite)",fontWeight:500}}>
                    üì∏ Tap to retake photo
                  </div>
                </>
              : <>
                  <span className="icon">üì∑</span>
                  <div className="hint">Tap to Open Camera</div>
                  <div className="sub" style={{fontFamily:"'Tiro Kannada',serif",fontSize:13,marginTop:6}}>
                    ‡≤ï‡≥ç‡≤Ø‡≤æ‡≤Æ‡≥Ü‡≤∞‡≤æ ‡≤§‡≥Ü‡≤∞‡≥Ü‡≤Ø‡≤≤‡≥Å ‡≤í‡≤§‡≥ç‡≤§‡≤ø
                  </div>
                  <div style={{
                    display:"inline-flex",alignItems:"center",gap:6,
                    marginTop:12,padding:"7px 16px",
                    background:"rgba(90,158,74,0.15)",
                    border:"1.5px solid rgba(90,158,74,0.35)",
                    borderRadius:20,fontSize:12,color:"var(--leaf-lite)"
                  }}>
                    üåø Point camera at the leaf
                  </div>
                </>
            }
          </div>
        </div>

        <button className="km-btn" onClick={detect} disabled={loading}>
          {loading
            ? <><span className="km-spin">‚ü≥</span> Analyzing‚Ä¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü</>
            : <><span>ü§ñ</span> Detect Disease ‚Äì ‡≤∞‡≥ã‡≤ó ‡≤ï‡≤Ç‡≤°‡≥Å‡≤π‡≤ø‡≤°‡≤ø</>
          }
        </button>

        {result && (
          <div className={`km-result ${result.severity === "High" || result.severity === "Very High" ? "danger" : ""}`}>
            <div className="km-result-head">
              <div className={`badge ${result.severity === "Medium" ? "ok" : "warn"}`}>
                {result.severity === "Medium" ? "‚ö†Ô∏è" : "üî¥"}
              </div>
              <div>
                <h4>{result.disease}</h4>
                <div className="conf">AI Confidence: {result.confidence} ¬∑ Severity: {result.severity}</div>
              </div>
            </div>
            <div className="km-detail-row">
              <span className="dt">Cause</span>
              <span className="dd">{result.cause}</span>
            </div>
            <div className="km-detail-row">
              <span className="dt">Treatment</span>
              <span className="dd">{result.treatment}</span>
            </div>
            <div className="km-detail-row">
              <span className="dt">Pesticide</span>
              <span className="dd" style={{color:"var(--gold)"}}>{result.pesticide}</span>
            </div>
            <div className="km-detail-row">
              <span className="dt">Organic Alt</span>
              <span className="dd">{result.organic}</span>
            </div>
            <div className="km-kan-text">üì¢ {result.kannada}</div>
          </div>
        )}
      </div>
    </div>
  );
}

function IrrigationTab() {
  const [crop, setCrop] = useState("paddy");
  const [soil, setSoil] = useState("clay");
  const [schedule, setSchedule] = useState(null);
  const [loading, setLoading] = useState(false);

  const generate = () => {
    setLoading(true);
    setSchedule(null);
    const key = `${crop}_${soil}`;
    const data = IRRIGATION_SCHEDULES[key] || IRRIGATION_SCHEDULES["paddy_clay"];
    setTimeout(() => { setLoading(false); setSchedule(data); }, 1200);
  };

  const soilMap = { paddy:["clay","loam"], maize:["red","loam"], arecanut:["laterite","clay"] };

  return (
    <div>
      <div className="km-section-head">
        <div className="km-section-head">
          <div className="icon" style={{background:"linear-gradient(135deg,var(--sky),#2E7AA0)"}}>üíß</div>
          <div className="texts">
            <h3>Smart Irrigation</h3>
            <p style={{fontFamily:"'Tiro Kannada',serif",fontSize:12}}>‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® ‡≤Ü‡≤ß‡≤æ‡≤∞‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤∏‡≤≤‡≤π‡≥Ü</p>
          </div>
        </div>
      </div>

      <div className="km-card">
        <div className="km-row2">
          <div>
            <label className="km-label">Crop / ‡≤¨‡≥Ü‡≤≥‡≥Ü</label>
            <select className="km-select" value={crop} onChange={e=>{ setCrop(e.target.value); setSoil(soilMap[e.target.value][0]); setSchedule(null); }}>
              <option value="paddy">üåæ Paddy</option>
              <option value="maize">üåΩ Maize</option>
              <option value="arecanut">üå¥ Arecanut</option>
            </select>
          </div>
          <div>
            <label className="km-label">Soil / ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å</label>
            <select className="km-select" value={soil} onChange={e=>{ setSoil(e.target.value); setSchedule(null); }}>
              {soilMap[crop].map(s => (
                <option key={s} value={s}>{s.charAt(0).toUpperCase()+s.slice(1)}</option>
              ))}
            </select>
          </div>
        </div>
        <button className="km-btn green" onClick={generate} disabled={loading}>
          {loading
            ? <><span className="km-spin">‚ü≥</span> Calculating‚Ä¶</>
            : <><span>üóìÔ∏è</span> Get Weekly Schedule ‚Äì ‡≤µ‡≤æ‡≤∞‡≤¶ ‡≤µ‡≥á‡≤≥‡≤æ‡≤™‡≤ü‡≥ç‡≤ü‡≤ø</>
          }
        </button>

        {schedule && (
          <div className="km-schedule">
            <div style={{fontSize:12,color:"var(--muted)",marginBottom:10}}>
              üìÖ This week's irrigation plan ¬∑ {crop} on {soil} soil
            </div>
            {schedule.map((row, i) => (
              <div key={i} className={`km-day-row ${row.type}`} style={{animationDelay:`${i*0.06}s`}}>
                <div className="day-icon">{row.icon}</div>
                <div className="day-info">
                  <div className="day-name">{row.day}</div>
                  <div className="day-detail">{row.detail}</div>
                </div>
                <div className="day-amount">{row.amount}</div>
              </div>
            ))}
            <div style={{background:"rgba(91,163,201,0.08)",border:"1px solid rgba(91,163,201,0.2)",borderRadius:12,padding:"10px 13px",marginTop:10,fontSize:12,color:"var(--sky-lite)"}}>
              üí° ‡≤∏‡≥Ç‡≤ö‡≤®‡≥Ü: ‡≤Æ‡≤≥‡≥Ü ‡≤¨‡≤Ç‡≤¶‡≤∞‡≥Ü ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤∏‡≥ç‡≤•‡≤ó‡≤ø‡≤§‡≤™‡≤°‡≤ø‡≤∏‡≤ø. ‡≤¨‡≥Ü‡≤≥‡≤ø‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤®‡≥Ä‡≤∞‡≥Å ‡≤π‡≤æ‡≤ï‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å ‡≤â‡≤§‡≥ç‡≤§‡≤Æ.
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

function MandiTab() {
  const [filter, setFilter] = useState("All");
  const filters = ["All","Karnataka","Trending Up","Trending Down"];
  const visible = filter === "Trending Up"
    ? MANDI_PRICES.filter(m=>m.dir==="up")
    : filter === "Trending Down"
    ? MANDI_PRICES.filter(m=>m.dir==="down")
    : MANDI_PRICES;

  const sparkData = {
    up:   [100,102,99,105,103,108,110],
    down: [110,108,112,105,103,100,98],
    flat: [103,104,102,104,103,105,103],
  };
  const sparkColor = { up:"#7CC46A", down:"#E07040", flat:"#5BA3C9" };

  return (
    <div>
      <div className="km-section-head">
        <div className="km-section-head">
          <div className="icon" style={{background:"linear-gradient(135deg,var(--harvest),#8A5A00)"}}>üìä</div>
          <div className="texts">
            <h3>Mandi Prices ‚Äì ‡≤Æ‡≤Ç‡≤°‡≤ø ‡≤¶‡≤∞</h3>
            <p>Live Karnataka APMC prices ¬∑ Updated 7:30 AM</p>
          </div>
        </div>
      </div>

      <div className="km-mandi-filter">
        {filters.map(f => (
          <button key={f} className={`km-filter-pill ${filter===f?"active":""}`} onClick={()=>setFilter(f)}>{f}</button>
        ))}
      </div>

      <div className="km-mandi-grid">
        {visible.map((m, i) => (
          <div key={i} className="km-mandi-item">
            <span className="crop-icon">{m.icon}</span>
            <div className="crop-name">{m.crop}</div>
            <div className="crop-kan">{m.kan}</div>
            <div className="crop-price">{m.price}</div>
            <div className="crop-unit">{m.unit}</div>
            <Sparkline data={sparkData[m.dir]} color={sparkColor[m.dir]} />
            <div className={`trend ${m.dir}`}>
              {m.dir==="up"?"‚Üë":m.dir==="down"?"‚Üì":"‚Üí"} {m.change}
            </div>
            <div style={{fontSize:10,color:"var(--muted)",marginTop:6}}>{m.mandi} APMC</div>
          </div>
        ))}
      </div>

      <div className="km-best-sell">
        <span className="bs-icon">üí°</span>
        <div>
          <h4>Best Selling Window ‚Äì ‡≤Æ‡≤æ‡≤∞‡≤æ‡≤ü ‡≤∏‡≤Æ‡≤Ø</h4>
          <p>Paddy & Ragi: Sell Thu‚ÄìSat this week ¬∑ prices rising by 2‚Äì3%. Arecanut: Wait 10 days, forecast shows +5% recovery.</p>
          <p style={{fontFamily:"'Tiro Kannada',serif",fontSize:12,color:"var(--parch)",marginTop:6}}>‡≤≠‡≤§‡≥ç‡≤§ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∞‡≤æ‡≤ó‡≤ø: ‡≤à ‡≤µ‡≤æ‡≤∞ ‡≤ó‡≥Å‡≤∞‡≥Å‚Äì‡≤∂‡≤®‡≤ø ‡≤Æ‡≤æ‡≤∞‡≤æ‡≤ü ‡≤Æ‡≤æ‡≤°‡≤ø. ‡≤Ö‡≤°‡≤ø‡≤ï‡≥Ü: 10 ‡≤¶‡≤ø‡≤® ‡≤§‡≤°‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø.</p>
        </div>
      </div>
    </div>
  );
}

function VoiceTab() {
  const [listening, setListening] = useState(false);
  const [chat, setChat] = useState([
    { role:"bot", kan:"‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤®‡≤æ‡≤®‡≥Å ‡≤ï‡≥É‡≤∑‡≤ø ‡≤Æ‡≤ø‡≤§‡≥ç‡≤∞. ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø.", eng:"Hello! I am Krishi Mitra. Ask me anything." }
  ]);
  const logRef = useRef();

  const askQuestion = (qa) => {
    const newChat = [...chat,
      { role:"user", kan: qa.q, eng:"" },
    ];
    setChat(newChat);
    setTimeout(() => {
      setChat(c => [...c, { role:"bot", kan: qa.a_kan, eng: qa.a_eng }]);
    }, 900);
  };

  const toggleMic = () => {
    setListening(l => !l);
    if (!listening) {
      setTimeout(() => {
        setListening(false);
        const qa = CHAT_QA[Math.floor(Math.random()*CHAT_QA.length)];
        askQuestion(qa);
      }, 2500);
    }
  };

  useEffect(() => {
    if (logRef.current) logRef.current.scrollTop = logRef.current.scrollHeight;
  }, [chat]);

  return (
    <div>
      <div className="km-section-head">
        <div className="km-section-head">
          <div className="icon" style={{background:"linear-gradient(135deg,var(--terra),#7C2A08)"}}>üé§</div>
          <div className="texts">
            <h3>Voice Assistant</h3>
            <p style={{fontFamily:"'Tiro Kannada',serif",fontSize:12}}>‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≤ø, ‡≤â‡≤§‡≥ç‡≤§‡≤∞ ‡≤™‡≤°‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø</p>
          </div>
        </div>
      </div>

      <div className="km-voice-center">
        <div className="km-mic-wrapper">
          {listening && <>
            <div className="km-mic-ring" />
            <div className="km-mic-ring" />
            <div className="km-mic-ring" />
          </>}
          <button className={`km-mic-btn ${listening?"listening":""}`} onClick={toggleMic}>
            {listening ? "‚èπÔ∏è" : "üé§"}
          </button>
        </div>
        <div className="km-voice-prompt">
          {listening ? "‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≤ø‚Ä¶ Listening‚Ä¶" : "‡≤Æ‡≥à‡≤ï‡≥ç ‡≤í‡≤§‡≥ç‡≤§‡≤ø ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≤ø"}
        </div>
        <div className="km-voice-hint">
          {listening ? "Tap to stop" : "Tap mic to ask in Kannada"}
        </div>
      </div>

      <div className="km-card" style={{padding:"14px 14px 10px"}}>
        <div className="km-chat-log" ref={logRef}>
          {chat.map((m, i) => (
            <div key={i} className={`km-bubble ${m.role}`}>
              <span className="bkan">{m.kan}</span>
              {m.eng && <span className="beng">{m.eng}</span>}
            </div>
          ))}
          {listening && (
            <div className="km-bubble user">
              <span className="bkan km-spin" style={{display:"inline-block"}}>‚ü≥</span>
            </div>
          )}
        </div>
      </div>

      <div style={{marginTop:14}}>
        <div style={{fontSize:12,color:"var(--muted)",marginBottom:8}}>Quick Questions / ‡≤§‡≥ç‡≤µ‡≤∞‡≤ø‡≤§ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å</div>
        <div className="km-quick-btns">
          {CHAT_QA.map((qa, i) => (
            <button key={i} className="km-quick" onClick={()=>askQuestion(qa)}>{qa.q}</button>
          ))}
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ ROOT APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
export default function KrishiMitra() {
  const [tab, setTab] = useState(0);

  const tabs = [
    { label:"‡≤∞‡≥ã‡≤ó", icon:"üî¨", title:"Disease" },
    { label:"‡≤®‡≥Ä‡≤∞‡≥Å", icon:"üíß", title:"Irrigation" },
    { label:"‡≤¶‡≤∞",   icon:"üìä", title:"Mandi" },
    { label:"‡≤Æ‡≤æ‡≤§‡≥Å", icon:"üé§", title:"Voice" },
  ];

  const pages = [<DiseaseTab/>, <IrrigationTab/>, <MandiTab/>, <VoiceTab/>];

  return (
    <>
      <style>{css}</style>
      <div className="km-root">
        {/* Header */}
        <header className="km-header">
          <div className="km-hdr-row">
            <div className="km-brand">
              <div className="km-logo">üåæ</div>
              <div className="km-brand-text">
                <h1>KRISHI MITRA</h1>
                <span className="kan">‡≤ï‡≥É‡≤∑‡≤ø ‡≤Æ‡≤ø‡≤§‡≥ç‡≤∞ ‚Äì ‡≤∞‡≥à‡≤§‡≤∞ ‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤ø‡≤§</span>
              </div>
            </div>
            <div className="km-weather">üå§ 28¬∞C ¬∑ Humid</div>
          </div>

          {/* Hero band */}
          <div className="km-hero">
            <h2>‡≤â‡≤§‡≥ç‡≤§‡≤Æ ‡≤ï‡≥É‡≤∑‡≤ø, ‡≤â‡≤§‡≥ç‡≤§‡≤Æ ‡≤ú‡≥Ä‡≤µ‡≤®</h2>
            <p>Better Farming ¬∑ Better Living ¬∑ Karnataka</p>
            <div className="km-hero-pills">
              <div className="km-pill"><span className="pv">4</span><span className="pl">AI Tools</span></div>
              <div className="km-pill"><span className="pv">18</span><span className="pl">Mandis Live</span></div>
              <div className="km-pill"><span className="pv">3</span><span className="pl">Crops</span></div>
            </div>
          </div>
        </header>

        {/* Nav */}
        <nav className="km-nav">
          {tabs.map((t, i) => (
            <button key={i} className={`km-tab ${tab===i?"active":""}`} onClick={()=>setTab(i)}>
              <span>{t.icon}</span>
              <span style={{fontFamily:"'Tiro Kannada',serif"}}>{t.label}</span>
              <span style={{fontSize:10,opacity:0.7}}>{t.title}</span>
            </button>
          ))}
        </nav>

        {/* Content */}
        <main className="km-content" key={tab}>
          {pages[tab]}
        </main>

        {/* Bottom nav */}
        <nav className="km-bottom-nav">
          {tabs.map((t, i) => (
            <button key={i} className={`km-bnav-item ${tab===i?"active":""}`} onClick={()=>setTab(i)}>
              <span className="bni">{t.icon}</span>
              <span className="bnl">{t.label}</span>
            </button>
          ))}
        </nav>
      </div>
    </>
  );
}